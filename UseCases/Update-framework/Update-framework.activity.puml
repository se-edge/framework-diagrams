@startuml
legend top left
ğŸ—² is a system telemetry
endlegend

start
-> Twin update;
:ğŸ—² Update framework in progress;
if (Pull EdgeUpdater image) then (fail)
    :Update Twin;
    stop
endif
if (Run edgeupdater container) then (fail)
    :Update Twin;
    stop
endif

partition EdgeUpdater {
    :Check edgemanager container exist
    and new image present localy;
    :Remove oldedgemanager container if exist;
    :Stop edgemanager;
    if (Rename edgemanager to oldedgemanager) then (fail)
        :Start edgemanager;
        stop
    endif
    if (Create edgemanager container with new image) then (fail)
        :Rename oldegemanager to edgemanager;
        :Start edgemanager;
        stop
    endif
    if (Start edgemanager (reach Healthy) then (fail)
        :Remove edgemanager;
        :Rename oldegemanager to edgemanager;
        :Start edgemanager;
        stop
    endif
    :Remove oldedgemanager container;
    stop
}
@enduml
